<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificador de Senha</title>
    <!-- CSS agora está em um arquivo separado -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h2>Verificador de Segurança de Senha</h2>
    <input type="password" id="senha" placeholder="Digite sua senha">

    <div id="gamificacao-container">
        <h3>Desafio:</h3>
        <p id="passo-descricao">Digite uma senha com pelo menos 12 caracteres.</p>
        <!-- O erro de espaço será exibido aqui -->
        <p id="passo-feedback"></p>
        <div id="progresso-barra">
            <div id="progresso"></div>
        </div>
    </div>

    <div id="resultado-container">
        <h3>Resultado:</h3>
        <p><strong>Classificação:</strong> <span id="classificacao">-</span></p>
        <ul>
            <li id="li-comprimento" class="oculto">Comprimento ≥ 12: <span id="comprimento">❌</span></li>
            <li id="li-maiuscula" class="oculto">Letra maiúscula: <span id="maiuscula">❌</span></li>
            <li id="li-minuscula" class="oculto">Letra minúscula: <span id="minuscula">❌</span></li>
            <li id="li-numero" class="oculto">Número: <span id="numero">❌</span></li>
            <li id="li-simbolo" class="oculto">Símbolo: <span id="simbolo">❌</span></li>
            <li id="li-repeticoes" class="oculto">Sem muitas repetições: <span id="repeticoes">❌</span></li>
            <li id="li-comum" class="oculto">Não é comum/fraca: <span id="comum">❌</span></li>
        </ul>
    </div>

    <script>
        // Critérios gamificados em ordem
        const criterios = [
            {
                id: 'comprimento',
                descricao: 'Digite uma senha com pelo menos 12 caracteres.',
                validar: senha => senha.length >= 12,
                erro: 'A senha precisa ter pelo menos 12 caracteres.'
            },
            {
                id: 'maiuscula',
                descricao: 'Adicione pelo menos uma letra maiúscula.',
                validar: senha => /[A-Z]/.test(senha),
                erro: 'Inclua pelo menos uma letra maiúscula.'
            },
            {
                id: 'minuscula',
                descricao: 'Adicione pelo menos uma letra minúscula.',
                validar: senha => /[a-z]/.test(senha),
                erro: 'Inclua pelo menos uma letra minúscula.'
            },
            {
                id: 'numero',
                descricao: 'Adicione pelo menos um número.',
                validar: senha => /\d/.test(senha),
                erro: 'Inclua pelo menos um número.'
            },
            {
                id: 'simbolo',
                descricao: 'Adicione pelo menos um símbolo especial.',
                validar: senha => /[!@#$%^&*(),.?":{}|<>]/.test(senha),
                erro: 'Inclua pelo menos um símbolo especial.'
            },
            {
                id: 'repeticoes',
                descricao: 'Evite muitas repetições do mesmo caractere.',
                validar: senha => {
                    if (!senha) return false;
                    const maxRep = Math.max(...Array.from(new Set(senha)).map(c => senha.split(c).length - 1));
                    return maxRep <= senha.length / 2;
                },
                erro: 'Evite repetir muito o mesmo caractere.'
            },
            {
                id: 'comum',
                descricao: 'Não use senhas comuns ou padrões fracos.',
                validar: senha => {
                    const fracas = ['123456', 'password', 'qwerty', 'abc123', 'senha123'];
                    const padroes = [/^\d{6,}$/, /^(.)\1{5,}$/, /^(qwerty|asdfgh|zxcvbn|12345|abcdef)$/];
                    if (fracas.includes(senha.toLowerCase())) return false;
                    if (padroes.some(p => p.test(senha.toLowerCase()))) return false;
                    return true;
                },
                erro: 'Evite senhas comuns ou padrões fracos.'
            }
        ];
        
        document.getElementById('senha').addEventListener('input', (event) => {
            const senhaInput = event.target;
            const senha = senhaInput.value;
            const passoFeedback = document.getElementById('passo-feedback');
            const resultadoContainer = document.getElementById('resultado-container');
            const progressoBarra = document.getElementById('progresso-barra');
            const passoDescricao = document.getElementById('passo-descricao');

            // Valida a presença de espaços em branco primeiro.
            if (/\s/.test(senha)) {
                passoDescricao.style.display = 'none';
                progressoBarra.style.display = 'none';
                resultadoContainer.style.display = 'none';
                
                passoFeedback.innerText = 'A senha não pode conter espaços em branco.';
                passoFeedback.style.color = '#e62e2e';
                senhaInput.classList.add('erro');

            } else {
                passoDescricao.style.display = 'block';
                progressoBarra.style.display = 'block';
                resultadoContainer.style.display = 'block';

                senhaInput.classList.remove('erro');
                
                atualizarGamificacao();
            }
        });

        function atualizarGamificacao() {
            const senha = document.getElementById('senha').value;
            
            criterios.forEach(criterio => {
                const li = document.getElementById(`li-${criterio.id}`);
                const span = document.getElementById(criterio.id);
                if (li) {
                    const valido = criterio.validar(senha);
                    span.textContent = valido ? '✅' : '❌';
                    li.classList.toggle('oculto', !senha);
                }
            });

            let passo = 0;
            while (passo < criterios.length && criterios[passo].validar(senha)) {
                passo++;
            }

            const passoDescricao = document.getElementById('passo-descricao');
            const passoFeedback = document.getElementById('passo-feedback');

            if (passo < criterios.length) {
                passoDescricao.innerText = criterios[passo].descricao;
                passoFeedback.innerText = (senha && !criterios[passo].validar(senha)) ? criterios[passo].erro : '';
                passoFeedback.style.color = '#e62e2e';
            } else {
                passoDescricao.innerText = 'Parabéns! Sua senha passou por todos os desafios!';
                passoFeedback.innerText = '';
            }

            const progresso = document.getElementById('progresso');
            progresso.style.width = ((passo / criterios.length) * 100) + '%';
            
            const classificacoes = ['Muito Fraca', 'Fraca', 'Moderada', 'Forte', 'Muito Forte', 'Extremamente Forte', 'Impressionante'];
            const classificacaoTexto = !senha ? '-' : classificacoes[Math.min(passo, classificacoes.length - 1)];
            document.getElementById('classificacao').innerText = classificacaoTexto;
        }

        atualizarGamificacao();
    </script>
</body>
</html>
